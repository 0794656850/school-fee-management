{% extends "base.html" %}
{% block title %}Billing & Upgrade - {{ APP_TITLE }}{% endblock %}
{% block page_title %}Billing & Upgrade{% endblock %}
{% block content %}

<div class="max-w-3xl mx-auto">
  <div class="bg-white border rounded-2xl shadow p-6">
    <h3 class="text-lg font-semibold">Your Plan</h3>
    {% if is_pro %}
      <div class="mt-2 text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg p-3">
        <strong>Pro Active:</strong> advanced features enabled (invoices, discounts, term analytics, WhatsApp receipts, exports).
      </div>
    {% else %}
      <div class="mt-2 text-sm text-gray-700 bg-indigo-50 border border-indigo-200 rounded-lg p-3">
        <strong>Free Plan:</strong> core fee management is active. Upgrade to unlock advanced features and priority support.
      </div>
    {% endif %}

    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div class="border rounded-xl p-4">
        <div class="font-medium">Activate with M-Pesa Reference</div>
        <p class="text-xs text-gray-500 mt-1">Paste the unique M-Pesa receipt/transaction code (e.g., QDA7X1ABC2). Each code can be used once.</p>
        <form class="mt-3 flex flex-col gap-2" method="post" action="{{ url_for('admin.billing') }}">
          <input type="text" name="license_key" value="" placeholder="Enter M-Pesa reference (e.g., QDA7X1ABC2)" class="border rounded-lg px-3 py-2 text-sm" autocomplete="off">
          <button class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-3 py-2 text-sm">Activate</button>
        </form>
      </div>
      <div class="border rounded-xl p-4">
        <div class="font-medium">Buy Pro</div>
        <p class="text-sm text-gray-600 mt-1">Pay securely with M-Pesa STK push. You will receive a prompt on your phone.</p>
        {% if not mpesa_ok %}
        <div class="mt-2 text-sm text-rose-700 bg-rose-50 border border-rose-200 rounded-lg p-3">
          M-Pesa is not configured. <a href="{{ url_for('admin.mpesa_config') }}" class="underline">Configure Daraja settings</a> to enable STK push.
        </div>
        {% endif %}
        <form class="mt-3 flex flex-col sm:flex-row gap-2" method="post" action="{{ url_for('mpesa.checkout') }}">
          <input type="tel" name="phone" placeholder="Your M-Pesa number (e.g., 07xx...)" class="border rounded-lg px-3 py-2 text-sm flex-1" required>
          <input type="hidden" name="amount" value="{{ PRO_PRICE_KES }}">
          <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg px-4 py-2 text-sm inline-flex items-center gap-2 {% if not mpesa_ok %}opacity-60 cursor-not-allowed{% endif %}" {% if not mpesa_ok %}disabled{% endif %}>
            <img src="{{ url_for('static', filename='images/mpesa_logo.svg') }}" alt="M-Pesa logo" class="h-5 w-auto inline" />
            <span class="font-semibold">Pay KES {{ PRO_PRICE_KES }}</span>
          </button>
        </form>
        <p class="text-xs text-gray-500 mt-2">After payment, activation is automatic. If not, paste your M-Pesa reference above.</p>
      </div>
    </div>

  <div class="mt-8">
      <h4 class="font-semibold">What you get with Pro</h4>
      <ul class="mt-2 list-disc text-sm text-gray-700 pl-6 space-y-1">
        <li>Per-class defaults, per-student overrides, and discounts</li>
        <li>Invoice generation and printable itemized statements</li>
        <li>Email reminders (Gmail API) and optional WhatsApp receipts</li>
        <li>Advanced term analytics and exports</li>
        <li>Priority support and white-label branding</li>
      </ul>
      <div class="mt-4 text-sm text-gray-700 bg-amber-50 border border-amber-200 rounded-lg p-3">
        Prefer fixed plans? Monthly KES {{ PRO_PRICE_KES }}, Yearly KES 15000 <span class="inline-block bg-yellow-100 text-yellow-800 px-1 py-0.5 rounded">Save 3000</span>, Lifetime KES 50000. Use this Billing &amp; Upgrade page to document manual payment references and verify activations.
      </div>
    </div>
  </div>
</div>

<script>lucide.createIcons();</script>
{% endblock %}
